# HTTP
HTTP는 어플리케이션 계층으로서, 웹 서비스 통신이다.
HTTP는 1.0 ~ 현재 3을 사용한다.

### HTTP/1.0
1.0은 한 연결당 하나의 요청을 처리한다.
이것은 RTT 증가를 불러오게 되어있다.
서버에서 파일을 가져올 때마다, TCP의 3-웨이 핸드셰이크를 계속해서 열어야 하기에 RTT가 증가하는 단점이 있다.
    - RTT 증가
    클라이언트가 서버에 요청한 순간 부터 받기 까지, 패킷이 목적지에 도달하고 출발지로 돌아오기까지의 시간이다. (패킷 왕복 시간)

##### RTT 증가 해결 방법
RTT증가로 서버에 부담이 가고, 응답 시간이 길어진다.
해결방법으로 이미지 스플리팅, 코드 압축, Base64 인코딩을 사용했다.
    - 이미지 스플리팅
    많은 이미지는 따로 받지않고 합쳐진 하나의 이미지를 받고 background-image의 position을 이용하여 표기하는 방법이다.
    - 코드 압축
    코드를 압축해서 개행문자, 빈칸을 업애어 코드 크기를 최소하 하는 방법이다. (ex. min.js)
    - 이미지 Base64 인코딩
    이미지 파일을 64진법으로 이루어진 문자열로 인코딩하는 방법이다.
    이미지에 대해 서버에 HTTP 요청을 할 필요가 없다는 장점이다.
    * 인코딩 : 정보의 형태나 형식을 표준화, 보안, 처리속도 향상, 저장 공간 절약 등을 위해 다른 형태나 형식으로 변환하는 처리 방식

### HTTP/1.1
매번 TCP 연결을 하는 것이 아니라 한 번 TCP를 초기화 한 이후, keep-alive라는 옵션으로 여러 개의 파일을 송수신할 수 있게 바뀌었다.
1.1 부터 표준화가 되어 기본 옵션으로 설정되었다.

1.0은 connection : closed - 통신시, 시작의 hanshake와 끝의 TearDown를 매번 하지만
1.1은 connection : keep-alive - 작업을 시작 시, handshake 마치면 TearDown을 한다.
하지만 리소스 개수에 비례하여 시간이 길어진다.

##### HOL Blocking(Head Of Line Blocking)
네트워크에서 같은 큐에 있는 패킷이 첫 번째 패킷으로 인해 지연될 때 발생하는 성능 저하 현상을 말합니다.
순차적으로 처리되기에 앞 순번의 패킷이 느리게 받아지면 뒷 순번의 패킷들이 대기하게 되어 지연되는 현상이다.

##### 무거운 헤더 구조
헤더에는 쿠키 등 많은 메타데이터가 들어 있고, 압축이 되지 않아 무거웠다.

### HTTP/2
1.x 보다 지연 시간을 줄이고 응답 시간을 빠르게 하며, 멀티플렉싱, 헤더 압축, 서버 푸쉬, 요청의 우선순위 처리를 지원하는 프로토콜

    - 멀티플렉싱
    여러 개의 스트림을 사용하여 송수신한다.
    특정 스트림의 패킷을 손실하면 해당 스트림에만 영향을 미치며 나머지느 스트림은 문제없이 동작한다.
    병렬로 클라이언트에서 서버로 데이터를 처리하는데, 헤더와 데이터를 분리한 것을  스트림에 담아 보내고 분리한 데이터를 다시 조합하여 송수신한다.
    이렇게 여러 요청을 받고 응답을 줄일 수 있으며 1.x의 HOL Blocking 문제를 해결할 수 있다.
    - 헤더 압축
    1.x에서 헤더의 크기가 문제였는데, 2에서 허프만 코딩 압축 알고리즘(HPACK압축형식)을 사용하여 해결하였다.
    * 허프만 코딩(huffman coding) : 문자열을 문자 단위로 나누어 빈도가 높은 정보는 적은 비트수를 사용, 빈도가 낮은 정보는 비트 수를 많이 사용하여 비트양을 줄이는 원리
    - 서버 푸쉬
    1.1 : 서버에 요청해야 리소스 다운 (html 부터 css, js 등 여러차례 송수신을 반복하였다.)
    2   : 요청 없이 서버가 바로 푸쉬 (html을 요청하면 cdd, js 등 요청을 하지않고 바로 수신을 한다.)

### HTTPS
2는 HTTPS 위에서 동작한다.
어플리케이션 계층과 전송 계층 사이에 신뢰 계층인 SSL/TLS 계층을 넣어 신뢰할 수 있는 HTTP 요청을 말한다.(통신을 암호화)

##### SSL(Secure Socket Layer)/TLS(Transport Layer Security Protocol)
SSL 1.0 ~ 3.0 그리고 TLS 1.0 ~ 1.3 버전으로 올라가면서 SSL/TLS로 부른다.
보안을 제공하는 프로콜이다. 데이터를 다른 사람이 보거나 바꾸지(인터셉터) 못하게 한다.
보안 세션을 기반으로 데이터를 암호화하는데, 보안 세션이 만들어 질 때 인증 메커니즘, 키 교환 암호화 알고리즘, 해싱 알고리즘이 사용된다.
    * 보안 세션 : 보안의 시작과 끝에 유지되는 세션, 핸드셰이크를 통해 보안세션을 생성한다.
클라이언트에서 사이퍼슈트(cypher suites)를 서버에 전달하면 서버에서 암호화 알고리즘 리스트를 제공할 수 있는지 확인한다.
제공 가능 시, 클라이언트로 인증서를 보내 인증 메커니즘이 시작되며 해싱 알고리즘 등으로 암호화된 데이터의 송수신이 시작된다.
    * 사이퍼 슈트 : 프로토콜, AEAD 사이터 모드, 해싱 알고리즘이 나열된 규약이며 5가지가 있다.
    * AEAD(Authenticated Encryption with Associated Data) 사이퍼 모드 : AEAD는 데이터 암호화 알고리즘이다.
    - 인증 메커니즘
    CA(Certificate Authorities)에서 발급한 인증서를 기반으로 이루어진다.
    서버와의 안전한 연결을 위한 공개키를 클라이언트에게 제공하고 신뢰할 수 있는 서버임을 보장한다.
    인증서는 서비스 정보, 공개키, 지문, 디지털 서명 등으로 구성된다.
    - CA 발급 과정
    사이트 정보와 공개키를 CA에 제출해야 한다.
    * 암호화 알고리즘 : 대수곡선 기반의 ECDHE(Elliptic Curve Diffie-Hellman Ephermeral) 또는 모듈식 기반 DHE(Diffie-Hellman Ephermeral)를 사용
    둘 다 디피-헬만(Diffie-Hellman) 방식으로 만들어졌다.
    * 디피-헬만(Diffie-Hellman key exchange) : 암호키를 교환하는 하나의 방법
    * 해싱 알고리즘 : 데이터를 추정하기 힘들게 더 작게 그리고 섞여 있는 고작으로 만드는 알고리즘이다.
    SSL/TLS는 해싱 알고리즘으로 SHA-256과 SHA-384 알고리즘을 쓴다.
    - SHA-256 알고리즘
    비트코인을 비롯한 블록체인 시스템에서도 쓴다.
    해싱할 메시지에 1을 추가하는 등 전처리를 하고 전처리된 메시지를 기반으로 해시를 반환한다.
    * 해시 : 고정된 길이를 가진 데이터로 매핑
    * 해싱 : 해시로 바꿔주는 일(함수 역할)
    * 해시함수 : 일정한 길이의 데이터로 바꿔주는 함수
* TLS 1.3은 사이트 재방문 시, 보안 세션 만드는 통신을 거치지 않는다.(0-RTT)

##### SEO (Search Engine Optimization 검색엔진 최적화)
구글은 SSL를 강조하며 HTTPS 사이트가 HTTP 사이트보다 SEO 순위가 높을 것이라 공식적으로 입장을 내놓았다.
웹사이트 검색 시, HTTPS 사이트로 구성할 것 이라는 이야기다.
SEO순위를 높이기 위해 캐노니컬 설정, 메타 설정, 페이지 속도 개선, 사이트맵 관리 등이 있다.
    * 캐노니컬 설정 : <link rel="canonnical" href="https://bighwang.com/page" /> link에 캐노니털 설정
    * 메타 설정 : <meta property="analytics-track" content="Apple - Index/Tap"> 메타 설정
    * 페이지 속도 개선 : 구글의 PageSpeed Insights에서 서비스의 리포팅을 받으며 관리
    * 사이트맵 관리 : sitemap.xml

##### HTTPS 구축방법
    1. CA에서 구매한 인증키를 기반으로 HTTPS 서비스 구축한다.
    2. 서버 앞단의 HTTPS를 제공하는 로드밸런서를 둔다.
    3. 서버 앞단에 HTTPS를 제공하는 CDN을 두며 구축한다.

### HTTP/3
QUIC라는 계층 위에서 TCP 기반이 아닌 UDP 기반으로 돌아간다.

    2       3
    TLS     QUIC(TLS)
    TCP     UDP
    IP      IP

멀티플렉싱을 가지며 초기 연결 설정 시, 지연 시간 감소한다.

##### 초기 연결 설정
QUIC는 TCP를 사용하지 않아 3웨이 핸드셰이크과정을 거치지 않는다.
첫 연결 설정에 1-RTT만 소요된다
순방향 오류 수정 메커니즘(FEC, Forword Error Correction)으로 패킷 손실 시, 수신 측에서 에러 검출하고 수정하여 낮은 패킷 손실률을 제공한다.















