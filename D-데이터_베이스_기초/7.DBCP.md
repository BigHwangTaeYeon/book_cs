```text
25. DBCP (DB connection pool)ì˜ ê°œë…ë¶€í„° ì„¤ì • ë°©ë²•ê¹Œì§€! hikariCPì™€ MySQLì„ ì˜ˆì œë¡œ ì„¤ëª…
    -> req                  TCP ê¸°ë°˜
            App             ->              BD
                        Open connection(3 way handshake)
                        Query req ->
                        <- Query res
                        Close connection(4 way handshake)
    <- res
        ì´ë ‡ê²Œ ë§¤ë²ˆ connection ì„ ì—´ê³  ë‹«ëŠ” ì‹œê°„ì ì¸ ë¹„ìš© ë°œìƒ
        ì„œë¹„ìŠ¤ ì„±ëŠ¥ì— ì¢‹ì§€ ì•Šë‹¤.
        ì´ê±¸ í•´ê²°í•˜ê¸° ìœ„í•œ ê°œë…ì´ DBCP
    
    
    -> req                  TCP ê¸°ë°˜(connection ì„ ë¯¸ë¦¬ ì—°ê²°í•´ ë‘” connection pool)
            App             ->              BD
                get connection(connection pool ì—ì„œ ë¯¸ë¦¬ ì—°ê²°í•´ ë‘” connection ì„ ì‚¬ìš©)
                        Query req ->
                        <- Query res
                        Close connection(4 way handshake)
                close connection(connection ì„ ì¢…ë£Œ ì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹Œ connection pool ì— ë°˜ë‚©)
    <- res
        connection ìž¬ì‚¬ìš©
        ì—´ê³  ë‹«ëŠ” ì‹œê°„ ì ˆì•½
        ìœ„ì™€ ê°™ì€ connection pool ì„ database connection pool ì´ë¼ ë¶€ë¥¸ë‹¤.
        ê·¸ë¦¬ê³  ì¤„ì—¬ì„œ DBCP ë¼ê³  í•œë‹¤.        
    
    DBCP ì„¤ì • ë°©ë²• (SpringBoot 2.0ë¶€í„° í¬í•¨ëœ hikariCPì™€, MySQL ì„ ì˜ˆì œë¡œ ì„¤ëª…í•©ë‹ˆë‹¤)
        DB connection ì€ backend server ì™€ DB ì„œë²„ ì‚¬ì´ì˜ ì—°ê²°ì„ ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì—
        backend server ì™€ DB ì„œë²„ ê°ê°ì—ì„œì˜ ì„¤ì •(configuration) ë°©ë²•ì„ ìž˜ ì•Œê³  ìžˆì–´ì•¼ í•œë‹¤.
        
        DB ì„œë²„ ì„¤ì •(MySQL)
            max_connections : client ì™€ ë§ºì„ ìˆ˜ ìžˆëŠ” ìµœëŒ€ connection ìˆ˜
                (ë§Œì•½ App ì´ ê³¼ë¶€í•˜ê°€ ê±¸ë ¤ì„œ App ì„ í•˜ë‚˜ ë” ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤ë©´
                ì´ë¯¸ ìµœëŒ€ connection ìˆ˜ ë§Œí¼ App ê³¼ connection ì´ ì—°ê²°ë˜ì–´ ìžˆìœ¼ë©´
                ìƒˆë¡œìš´ App ê³¼ connection ì´ ë¶ˆê°€í•˜ë‹¤.)
            wait_timeout : connection ì´ inactive(ë†€ê³  ìžˆëŠ” ìƒí™©) í•  ë•Œ ë‹¤ì‹œ ìš”ì²­ì´ ì˜¤ê¸°ê¹Œì§€
                ì–¼ë§ˆì˜ ì‹œê°„ì„ ê¸°ë‹¤ë¦° ë’¤ì— close í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •
                - ë¹„ì •ìƒì ì¸ connection ì¢…ë£Œ ìƒíƒœ
                - connection ë‹¤ ì“°ê³  ë°˜í™˜ì´ ì•ˆë¨
                - ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ
                ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ìžˆìœ¼ë©´ App ì—ì„œëŠ” ë¬¸ì œë¡œ ì¸ì§€í•˜ì§€ë§Œ DB server ì—ì„œëŠ” ì¸ì§€í•˜ì§€ ëª»í•œë‹¤.
                ê·¸ëž˜ì„œ ì¡°ì¹˜í•˜ì§€ ëª»í•˜ê³  ì‚´ë ¤ë‘ê³  ìžˆìœ¼ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ê³„ì† ê°€ì§€ê³  ìžˆê³  connection ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì—
                ì‹œê°„ ì œí•œì„ ë‘ëŠ” ê²ƒì´ë‹¤.
        Backend ì„œë²„ ì„¤ì •(HikariCP)
            minimumIdle : pool ì—ì„œ ìœ ì§€í•˜ëŠ” ìµœì†Œí•œì˜ idle(ìš”ì²­ì´ ì˜¬ ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê³  ìžˆëŠ” ìƒíƒœ) connection ìˆ˜
            maximumPoolSize : pool ì´ ê°€ì§ˆ ìˆ˜ ìžˆëŠ” ìµœëŒ€ connection ìˆ˜
                ìµœëŒ€ connection ìˆ˜ : idle(inactive) ê³¼ active(in-use) connection ì„ í•©ì¹œ ìˆ˜
            
            idle connection ìˆ˜ê°€ minimumIdle ë³´ë‹¤ ì ê³ , ì „ì²´ connection ìˆ˜ë„ maximumPoolSize ë³´ë‹¤ ì ìœ¼ë©´
            ì‹ ì†í•˜ê²Œ ì¶”ê°€ë¡œ connection ì„ ë§Œë“ ë‹¤.
    
            minimumIdle ìˆ˜ê°€ 2ì´ê³ , maximumPoolSize 4ì¼ ë•Œ.
                connection ì„ 2ê°œ ë§Œë“¤ì–´ë‘ê³  í•˜ë‚˜ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ minimumIdle ì´ 2ê°œ ì´ê¸° ë•Œë¬¸ì— connection ì„ í•˜ë‚˜ ë” ë§Œë“ ë‹¤.
                connection ì„ 4ê°œ ì¤‘ 3ê°œê°€ ì‚¬ìš©ì¤‘ì´ë©´ minimumIdle ê°€ 2 ì´ì§€ë§Œ maximumPoolSize ê°€ 4ì´ê¸°ì— connection ì„ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.
                ê·¸ë¦¬ê³  req ê°€ ì¤„ì–´ë“¤ì–´ connection ì„ 2ê°œ ì´í•˜ë¡œ ë‘ì–´ë„ ëœë‹¤ë©´ ë‚˜ë¨¸ì§€ëŠ” ëŠê³  minimumIdle ë§Œí¼ ìœ ì§€í•œë‹¤.
                
                ë©”ë‰´ì–¼ì˜ ê¶Œìž¥ ì‚¬í•­ì€ minimumIdle ì˜ ê¸°ë³¸ ê°’ì€ maximumPoolSize ì™€ ë™ì¼(= pool size ê³ ì • ì´ë¼ëŠ” ëœ»)
                ê·¸ëŸ¬ë‹ˆê¹Œ ë”°ë¡œ ì„¤ì •í•˜ì§€ ë§ê³  maximumPoolSize ì™€ minimumIdle ê°’ì„ ê°™ê²Œ ë‘ë¼ëŠ” ë§.
                connection ì„ ë§Œë“¤ê³  ì†Œë©¸ì‹œí‚¤ëŠ” ê³¼ì • ìžì²´ê°€ ë‚­ë¹„ë¼ê³  ìƒê°í•œë‹¤ëŠ” ì˜ë¯¸
                
            maxLifetime : pool ì—ì„œ connection ì˜ ìµœëŒ€ ìˆ˜ëª…
                maxLifetime ì„ ë„˜ê¸°ë©´ idle ì˜ ê²½ìš° pool ì—ì„œ ë°”ë¡œ ì œê±°í•˜ê³  active ì¸ ê²½ìš° pool ë¡œ ë°˜í™˜ í›„ ì œê±°í•œë‹¤.
                (ì œê±°ë¥¼ í•˜ë©´ ë‹¤ì‹œ ë°”ë¡œ connection ì„ ìƒì„±í•œë‹¤.)
                pool ë¡œ ë°˜í™˜ì´ ì•ˆë˜ë©´ maxLifetime ë™ìž‘ì„ ì•ˆí•œë‹¤.
                DB ì˜ connection time limit ë³´ë‹¤ ëª‡ ì´ˆ ì§§ê²Œ ì„¤ì •í•´ì•¼ í•œë‹¤.
                    maxLifetime ê³¼ wait_timeout ì´ ë™ì¼ í•  ë•Œ, ê°™ì´ ì‹œìž‘ ë˜ì–´ connection ì´ ë‹¤ë¥¸ ìš”ì²­ì—ë„ ë°˜ì‘í•  ë•Œ
                    connection ì´ pool ì—ì„œ ë– ë‚˜ DB ë¡œ ê°€ëŠ” ë„ì¤‘
                    wait_timeout ì´ ì§€ë‚˜ê³  connection ì´ DB ì— ë„ì°©í•˜ë©´ ì´ë¯¸ ì—°ê²°ì„ ëŠì—ˆê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ìƒê¸´ë‹¤.
                    ê·¸ëž˜ì„œ maxLifetime ì„ wait_timeout ë³´ë‹¤ ì§§ê²Œ ì„¤ì •í•˜ë¼ëŠ” ëœ»ì´ë‹¤.
                    
            connectionTimeout : pool ì—ì„œ connection ì„ ë°›ê¸° ìœ„í•œ ëŒ€ê¸° ì‹œê°„
                connection pool ì—ì„œ ë³´ë‚¸ connection ì´ DB ì—ì„œ ë‹¤ì‹œ pool ê¹Œì§€ ëŒì•„ì˜¤ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
    
    ì ì ˆí•œ connection ìˆ˜ë¥¼ ì°¾ê¸° ìœ„í•œ ê³¼ì •
        1. ëª¨ë‹ˆí„°ë§ í™˜ê²½ êµ¬ì¶• (ì„œë²„ ë¦¬ì†ŒìŠ¤, ì„œë²„ ìŠ¤ë ˆë“œ ìˆ˜, DBCP ë“±ë“±)
        2. ë°±ì—”ë“œ ì‹œìŠ¤í…œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (nGrinder : ë„¤ì´ë²„ì—ì„œ ì œê³µí•˜ëŠ” ì„œë²„ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸)
        
        3. request per second ì™€ avg response time í™•ì¸ (ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì•Œì•„ë³¸ ê°’)
            request per second : ë‹¨ìœ„ ì´ˆ ë‹¹ ëª‡ê°œì˜ request ì²˜ë¦¬ê°€ ê°€ëŠ¥í•œì§€.
            avg response time : í‰ê· ì ì¸ ì‘ë‹µì‹œê°„
            ì–»ì€ ë°ì´í„°ì˜ ê·¸ëž˜í”„ë¥¼ ë³´ê³  ë¶€í•˜ê°€ ê±¸ë¦¬ëŠ” ë¶€ë¶„ì„ ì°¾ëŠ”ë‹¤.
            
        4. backend, DB server ì˜ CPU, MEM ë“±ë“± ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  í™•ì¸(ëª¨ë‹ˆí„°ë§)
            ë§Œì•½ backend ì—ì„œ 5-7~ 80% ê¹Œì§€ ì˜¬ë¼ê°„ë‹¤ë©´ backend ì„œë²„ì—ì„œ ë²„í‹°ê¸° ì–´ë µê¸°ì— ì„œë²„ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ ë‹¤ë¥¸ ì¡°ì¹˜ë¥¼ ì·¨í•´ì•¼ í•œë‹¤.
            DB ì„œë²„ì— ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì´ ì˜¬ë¼ê°„ë‹¤ë©´ replication, ì´ë¯¸ í–ˆë‹¤ë©´ secondary, cache layer(backend ì™€ DB ì‚¬ì´), sharding ë“±ë“±
            
        5. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì´ ë‚˜ì˜ì§€ ì•Šì„ ë•Œ, thread per request ëª¨ë¸ì´ë¼ë©´ active thread ìˆ˜ í™•ì¸
            ë¶€í•˜í…ŒìŠ¤íŠ¸ì—ì„œ ë¶€í•˜ê°€ ê±¸ë¦¬ ë¶€ë¶„ì—ì„œ ì „ì²´ ì“°ë ˆë“œ ê°œìˆ˜ì™€ active ì“°ë ˆë“œ ê°œìˆ˜ë¥¼ ë¹„êµí•˜ì—¬ thread ë¥¼ ëŠ˜ë ¤ì•¼ í•˜ëŠ”ì§€ í™•ì¸
            100ê°œ ì¤‘ 50ê°œê°€ active ë¼ë©´ ë‹¤ë¥¸ ê°ë„ì—ì„œ ì°¾ì•„ë´ì•¼í•œë‹¤.
                ì´ëŸ´ ë•Œ DBCP connection ìˆ˜ í™•ì¸ì„ í•œë‹¤.
                backend ì˜ maximumPoolSize ê°€ 5ì¼ ë•Œ, 5ê°œë¥¼ ë‹¤ ì‚¬ìš©í•œë‹¤ë©´ ì˜¬ë ¤ì„œ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ í•´ë´ì•¼í•œë‹¤.
                DB ì˜ max_connections ìˆ˜ë¥¼ maximumPoolSize ê°€ ì´ˆê³¼í•œë‹¤ë©´ maximumPoolSize ë¥¼ ëŠ˜ë ¤ì„œ maximumPoolSize ë¥¼ ì¡°ì ˆí•´ë³¸ë‹¤.
        
        6. ì‚¬ìš©í•  ë°±ì—”ë“œ ì„œë²„ ìˆ˜ë¥¼ ê³ ë ¤í•˜ì—¬ DBCP ì˜ max pool size ê²°ì •
            ë°±ì—”ë“œ ì„œë²„ 2ëŒ€ë¥¼ ê° 30ì”© maximumPoolSize ë¥¼ ì„¤ì •í•˜ê³  DB ì˜ max_connections ì„ 60ìœ¼ë¡œ ì„¤ì •í•˜ê³ 
            í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ê±°ë‚˜ request ëŒ€ë¹„ ë°±ì—”ë“œ ì„œë²„ê°€ ë¶ˆì•ˆí•˜ë‹¤ë©´
            ë°±ì—”ë“œ ì„œë²„ 3ëŒ€ë¥¼ ë‘ê³  20ì”© maximumPoolSize ë¥¼ ì„¤ì •ì„ í•´ë³´ê¸°ë„ í•œë‹¤.
            (ì—¬ëŸ¬ê°€ì§€ ì‹œë„ì™€ ìƒê°ì„ í•˜ë©´ì„œ ì„¤ì •í•˜ë¼ëŠ” ëœ»)

ðŸ”¸connectionì„ ì—¬ëŸ¬ ê°œ ë§Œë“¤ì–´ì„œ poolì— ì €ìž¥í•˜ê³  ìž¬ì‚¬ìš©í•˜ëŠ” ì´ ë°©ì‹ì€ 
DBì™€ ì—°ê²°í•  ë•Œë¿ë§Œ ì•„ë‹ˆë¼ ìžì£¼ ë„¤íŠ¸ì›Œí¬ í†µì‹ í•  ì¼ì´ ìžˆëŠ” ê·¸ ì–´ë–¤ ì¡´ìž¬ì™€ë„ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ë°©ì‹ìž…ë‹ˆë‹¤

ðŸ”¸04:37 DBCPì—ì„œ ë¹Œë¦° connectionì„ ë‹¤ì‹œ ë°˜í™˜ì„ í•  ë•Œ closeë¼ëŠ” ìš©ì–´ë¥¼ ì“°ëŠ” ê²ƒì€ ìžë°” ê¸°ì¤€ìž…ë‹ˆë‹¤ 
ë‹¤ë¥¸ ì–¸ì–´ì—ì„œëŠ” closeê°€ ì•„ë‹Œ ë‹¤ë¥¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤

ðŸ”¸31:14 thread per request ëª¨ë¸ ë§ê³ ë„ ê°€ë ¹ Spring webflux ì²˜ëŸ¼ ì´ë²¤íŠ¸ë£¨í”„ ë°©ì‹ì—ì„œë„ ìŠ¤ë ˆë“œ ìˆ˜ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤
ë‹¤ë§Œ ê°œì¸ì ìœ¼ë¡œëŠ” thread per request ëª¨ë¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìŠ¤ë ˆë“œí’€ì˜ ìŠ¤ë ˆë“œ ìˆ˜ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì˜í–¥ë ¥ì´ ë” í¬ë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì—
thread per requestë¥¼ ì˜ˆë¡œ ë“¤ì–´ì„œ ì„¤ëª…í•˜ê²Œ ëìŠµë‹ˆë‹¤

ðŸ”¸32:54 ì˜ˆì œë¥¼ ê°„ë‹¨ížˆ ë§Œë“¤ê¸° ìœ„í•´ì„œì˜€ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ë³‘ëª©ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ìŠ¤ë ˆë“œ ìˆ˜ë‚˜ DBCPì˜ ì»¤ë„¥ì…˜ ìˆ˜ ì™¸ì—ë„ ì—¬ëŸ¬ ì´ìœ ê°€ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
ë‹¤ì–‘í•œ ê°€ëŠ¥ì„±ì„ ì—¼ë‘í•´ ë‘ê³  í™•ì¸ì„ í•´ì•¼ í•©ë‹ˆë‹¤

ðŸ”¸34:37 max_connections ìˆ˜ëŠ” ì–´ëŠ ì •ë„ ì—¬ìœ ë¶„ì„ ë‘ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤ 
ì¦‰, max_connections ë³´ë‹¤ (ë°±ì—”ë“œ ì„œë²„ ìˆ˜ X DBCP max size)ê°€ ìž‘ê²Œ ìž¡íž ìˆ˜ ìžˆë„ë¡ DBCP max sizeë¥¼ ì„¤ì •í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤
ì™œëƒí•˜ë©´, ì¼ë°˜ì ì¸ ë°±ì—”ë“œ ì„œë²„ë“¤ ì™¸ì—ë„ ì—¬ëŸ¬ í˜•íƒœì˜ í´ë¼ì´ì–¸íŠ¸ë“¤ì´ ì¡´ìž¬í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤ (ê°€ë ¹ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì„œë²„ë‚˜ ê°œë°œìžë“¤ì´ ì“°ëŠ” í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ëž¨ ë“±ë“±)

ðŸ”¸ë„¤ì´ë²„D2 Commons DBCP ì´í•´í•˜ê¸° : https://d2.naver.com/helloworld/5102792
ðŸ”¸hikariCP github : https://github.com/brettwooldridge/HikariCP
ðŸ”¸MySQL ì„¤ì • íŽ˜ì´ì§€ : https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html
```