# ERD와 정규화 과정
ERD(Entity Relationship Diagram)는 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 하며, 릴레이션 간의 관계들을 정의한 것 입니다.

### ERD 중요성
ERD 기반으로 데이터베이스를 구축하는 설계도 역할을 합니다.
관계형 구조로 표현할 수 있는 데이터를 구성하는 데 유요하지만, 비정형 데이터를 충분히 표현할 수 없다는 단점이 있습니다.
- 비정형 데이터 : 비구조화 데이터를 말하며 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보
(4.1_데이터베이스의_기본 관계 참고)

### 정규화 과정
정규화 과정은 릴레이션 간 **잘못된 종속 관계**로 데이터베이스 이상 현상이 일어나 이를 해결하거나,
    **저장 공간을 효율적으로 사용**하기 위해 릴레이션을 여러 개로 분리하는 과정입니다.
- 데이터베이스 이상 현상 : 회원이 한 개의 등급을 가져야 하는데 여러 등급을 갖거나
    삭제할 때 필요한 데이터가 같이 삭제 되고,
    데이터를 삽입해야 하는데 필드 값이 NULL 이 되면 안되어서 삽입하기 어려운 현상들 입니다.

정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며
정규화된 정도는 정규형(NF, Normal Form)으로 표현합니다.
기본 정규형인 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형 이 있고
고급 정규형인  제4정규형,  제5정규형 이 있습니다.

##### 정규화 원칙
자료의 중복성은 감소
독립적인 관계는 별개의 릴레이션으로 표현
각각의 릴레이션은 독립적인 표현이 가능해야 한다는 것을 말합니다.

##### 제1정규형
모든 도메인이 더 이상 분해될 수 없는 원자 값(atomic value)만으로 구성되어야 합니다.
릴레이션의 속성 값 중, 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어서는 안됩니다.
(홍철 ID의 수강명이 두 개의 값을 가지면 레코드로 나누어야 한다.)
유저번호    유저ID    수강명         성취도
1          홍철      JAVA,C++      90%,10%

유저번호    유저ID    수강명         성취도
1          홍철      JAVA          90%
1          홍철      C++           10%
##### 제2정규형
릴레이션이 제1정규형이며 부분 함수의 종속성을 제거한 형태를 말합니다.
부분 함수의 종속성 제거란, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말합니다.
(기본키인 유저ID와 완전 종속된 유저번호 릴레이션을 분리)

유저번호    유저ID 
1          홍철    

유저ID    수강명         성취도
홍철      JAVA          90%
홍철      C++           10%

릴레이션을 분해할 때 동등한 릴레이션으로 분해해야 하고,
정보 손실이 발생하지 않는 무손실 분해로 되어야 합니다.

##### 제3정규형
제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)을 만족하지 않는 상태를 말합니다.

##### 이행적 함수 종속
A -> B와 B -> C 일 때, A -> C가 성립
집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 합니다.

유저번호    유저ID    수강명         가격
1          홍철      JAVA          10000
1          홍철      C++           8000

유저번호    유저ID
1          홍철 
1          홍철 

유저ID    수강명
홍철      JAVA 
홍철      C++ 

수강명         가격
JAVA          10000
C++           8000

##### 보이스/코드 정규형(BCNF)
제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여
릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태를 말합니다.
- 결정자 : 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소, 'X->Y' 일 때 X는 결정자 Y는 종속자

예)
- 각 수강명에 대해 한 학생은 오직 한 강사의 강의만 수강한다.
- 각 강사는 한 수강명만 담당한다.
- 한 수강명은 여러 강사가 담당할 수 있다.

학번      수강명     강사
1111    코딩테스트   큰돌
1111    JAVA       재엽
1121    코딩테스트   큰돌

이때, 범석이라는 강사가 롤인 수강명을 담당한다면 학번이 NULL이 된다.
또한, 학번과 수강명은 강사에 종속적이고 강사는 수강명에 종속적이다.

학번    강사                       수강명     강사
1111   큰돌                       코딩테스트  큰돌
1111   재엽                       JAVA      재엽
1121   큰돌                       롤        범석

위와 같이 정규형 과정을 통해 테이블을 분해할 수 있다.

참고로 정규형 과정을 통해 테이블을 나눈다하여 성능이 100% 좋아질 수는 없다.
조인을 해야하는 경우도 발생하여 오히려 느려질 수 있기에 서비스에 따라 정규화 또는 비정규화 과정을 진행해야한다.
